//common
var prizeIndex=0;
window.onload = function() {
  var arr = [];
  function audioAutoPlay(){
    var audio = document.getElementById('k_ring'),
        play = function(){
          audio.play();
          document.removeEventListener("touchstart",play, false);
        };
    audio.play();
    document.addEventListener("WeixinJSBridgeReady", function () {
      play();
    }, false);
    document.addEventListener('YixinJSBridgeReady', function() {
      play();
    }, false);
    document.addEventListener("touchstart",play, false);
  }

  function pauseAudio(){
    var audio = document.getElementById('k_ring');
    audio.pause();
  }

  document.getElementById("load").style.display = "none";
  //init
  // isLottery();
  var myswiper= new Swiper("#swiper-container-v", {
    speed: 500,
    direction: "vertical",
    // pagination: ".swiper-pagination",
    mousewheelControl: !0,
    // noSwiping : true,
    // noSwipingClass : 'stop-swiping',
    onInit: function(a) {
        a.myactive = 0;
        for (var b = 0; b < a.slides.length; b++) a.slides[b].style.zIndex = 0;
        a.slides[a.myactive].style.zIndex = 1,
        swiperAnimateCache(a),
        swiperAnimate(a);
    },
    onSlideChangeEnd: function(swiper){
       swiperAnimate(swiper); //每个slide切换结束时也运行当前slide动画
       $('.overLayer_share').addClass('hide').removeClass('show');
       $('.overLayer_success').addClass('hide').removeClass('show');
       $('#video_play').addClass('show').removeClass('hide');
    },
    onSlideChangeStart: function(swiper){
      swiperAnimate(swiper);
      if(swiper.activeIndex == 5){
        $('.arrow-box').addClass('hide').removeClass('show');
      }else {
        $('.arrow-box').addClass('show').removeClass('hide');
      }
      if(swiper.activeIndex == 0){
        pauseAudio();
      }else if(swiper.activeIndex == 1){
        audioAutoPlay();
      }
    },
    onTransitionStart: function(a) {
        a.params.onlyExternal = !0
    },
    onTransitionEnd: function(a) {
        a.params.onlyExternal = !1,
        a.myactive = a.activeIndex;
        for (var b = 0; b < a.slides.length; b++) a.slides[b].style.zIndex = 0;
        a.slides[a.myactive].style.zIndex = 1,
        swiperAnimate(a);
    },
    //watchSlidesProgress: !0,
    // onProgress: function(a) {
    //     var b, c, d, e;
    //     for (a.myactive || (a.myactive = 0), b = 0; b < a.slides.length; b++) c = a.slides[b],
    //     es = c.style,
    //     d = c.progress,
    //     e = d * a.height,
    //     opacity = 0,
    //     b == a.myactive && (opacity = 1 - Math.abs(d) / 2),
    //     (a.slides[a.myactive].progress > 0 && b == a.myactive + 1 || a.slides[a.myactive].progress < 0 && b == a.myactive - 1) && (opacity = .5 + Math.abs(.5 * a.slides[a.myactive].progress)),
    //     c.style.opacity = opacity,
    //     b != a.myactive && (es.webkitTransform = es.MsTransform = es.msTransform = es.MozTransform = es.OTransform = es.transform = "translate3d(0," + e + "px,0)")
    // },
    onSetTransition: function(a, b) {
        for (var c = 0; c < a.slides.length; c++) es = a.slides[c].style,
        es.webkitTransitionDuration = es.MsTransitionDuration = es.msTransitionDuration = es.MozTransitionDuration = es.OTransitionDuration = es.transitionDuration = b + "ms"
    }
  });


  //
  // $('.video_div').bind('click',function(){
  //     if($('#videoPlay1').paused){
  //         pauseAudio();
  //         $('#videoPlay1').play();
  //         $('#video_play').addClass('hide').removeClass('show');
  //     }else {
  //       $('#videoPlay1').pause();
  //       audioAutoPlay();
  //       $('#video_play').addClass('show').removeClass('hide');
  //     }
  // });
  $('.page1_now_order').bind('touchend',function(event){
    event.stopPropagation();
    $(".input_bg").css("background",'url(images/float/1/text_white_bg.png)');
    $(".input_bg").css("background-size",'100% 100%');
    $('.overLayer_share').addClass('show').removeClass('hide');
    $('.overLayer_success').addClass('hide').removeClass('show');
    $('.share_bg_div').addClass('show').removeClass('hide');
    $("#inputphone").val('');
  });
  $('.page6_now_share').bind('touchend',function(event){
    event.stopPropagation();
    $('.overLayer_success').addClass('show').removeClass('hide');
    $('.share_bg_div').addClass('hide').removeClass('show');
  });

  $('.page6_now_order').bind('touchend',function(event){
    event.stopPropagation();
    $(".input_bg").css("background",'url(images/float/1/text_white_bg.png)');
    $(".input_bg").css("background-size",'100% 100%');
    $('.overLayer_share').addClass('show').removeClass('hide');
    $('.overLayer_success').addClass('hide').removeClass('show');
    $("#inputphone").val('');
  });
  $('.input_bg_div').bind('touchend',function(event){
      event.stopPropagation();
  });
  $('.share_div').bind('touchend',function(event){
      event.stopPropagation();
  });
  $('.share_bg_div').bind('touchend',function(event){
      event.stopPropagation();
  });

  $('.overLayer').bind('touchend',function(event){
    $('.overLayer_share').addClass('hide').removeClass('show');
    $('.overLayer_success').addClass('hide').removeClass('show');
  });
  $('.float_confirm').bind('touchstart',function(){
    var phoneNum = $('#inputphone').val();
    if(validateTelphone(phoneNum)){
      getcode(phoneNum);
    }else{
      $(".input_bg").css("background",'url(images/float/1/text_error.png)');
      $(".input_bg").css("background-size",'100% 100%');
      $("#inputphone").val('');
    }
  });
  $('#inputphone').bind('touchstart',function(){
      $(".input_bg").css("background",'url(images/float/1/text_white_bg.png)');
      $(".input_bg").css("background-size",'100% 100%');
  });

  //submit
  // $('#submitInfo').bind('touchstart',function(){
  //   var userName=$('#userName').val();
  //   var userPhone=$('#userPhone').val();
  //   var userAddress=$('#userAddress').val();
  //   if(validateTelphone(userPhone)){
  //     var url='';
  //     var data={'userName':userName,'userPhone':userPhone,'userAddress':userAddress};
  //     $.ajax({
  //         type:'POST',
  //         url:url,
  //         data:data,
  //         dataType:'json',
  //         success:function(msg){
  //           console.log('success');
  //           //msg={state:'1'};  state:1 成功 state：0 失败
  //           var data=eval(msg);
  //           if(data.state.toString()=='1'){
  //             alert('提交成功');
  //           }
  //         },
  //         error:function(msg){
  //           console.log(msg);
  //         }
  //     });
  //   }
  // });


};


function getcode(phone){
  var url = "addpoint.php";
  var strjson={'phone':phone};
  $.ajax({
    type: "post",
    url: url,
    dataType: 'json',
    async:false,
    data: JSON.stringify(strjson),
    success: function(msg){
      var data=eval(msg);
      if(data.message.toString()=='ok'){
        var returnValue = data.code;
        $('.success_text').html(returnValue);
        $('.overLayer_share').addClass('hide').removeClass('show');
        $('.overLayer_success').addClass('show').removeClass('hide');
      }else {
          alert("预约失败，请稍后重试！");
      }

    },
    error:function(msg,error,c){
      alert("预约失败，请稍后重试！");
    }
  });
}

//validate
var validateTelphone=function(value){
  if(value.length==0){
    return false;
  }
  var reg=/^[0-9]{11}$/;
  if(!reg.test(value)){
    return false;
  }
  return true;
};
